<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <!-- í˜ì´ì§€ í—¤ë” -->
  <div class="md:flex md:items-center md:justify-between">
    <div class="flex-1 min-w-0">
      <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate">
        ğŸ‘¨â€âš•ï¸ ì¸ì‚¬/ê¸‰ì—¬
      </h2>
      <p class="mt-1 text-sm text-gray-500">
        ì§ì› ê´€ë¦¬, ê·¼íƒœ ê´€ë¦¬, ê¸‰ì—¬ ì²˜ë¦¬ ë° íœ´ê°€ ìŠ¹ì¸
      </p>
    </div>
  </div>

  <!-- ê¸°ëŠ¥ íƒ­ -->
  <div class="mt-6">
    <div class="border-b border-gray-200">
      <nav class="-mb-px flex space-x-8">
        <a href="#" class="border-blue-500 text-blue-600 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-tab="dashboard">
          ëŒ€ì‹œë³´ë“œ
        </a>
        <a href="#" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-tab="employees">
          ì§ì› ê´€ë¦¬
        </a>
        <a href="#" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-tab="attendance">
          ê·¼íƒœ ê´€ë¦¬
        </a>
        <a href="#" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-tab="leave">
          íœ´ê°€ ê´€ë¦¬
        </a>
        <a href="#" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-tab="payroll">
          ê¸‰ì—¬ ê´€ë¦¬
        </a>
      </nav>
    </div>
  </div>

  <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
  <div id="dashboard-tab" class="mt-8">
    <!-- ì£¼ìš” í†µê³„ ì¹´ë“œ -->
    <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
      <!-- ì´ ì§ì› ìˆ˜ -->
      <div class="bg-white overflow-hidden shadow rounded-lg">
        <div class="p-5">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                <span class="text-white text-sm font-bold">ğŸ‘¥</span>
              </div>
            </div>
            <div class="ml-5 w-0 flex-1">
              <dl>
                <dt class="text-sm font-medium text-gray-500 truncate">ì´ ì§ì›</dt>
                <dd class="text-lg font-medium text-gray-900" id="total-employees">-</dd>
              </dl>
            </div>
          </div>
        </div>
      </div>

      <!-- ì˜¤ëŠ˜ ì¶œê·¼ -->
      <div class="bg-white overflow-hidden shadow rounded-lg">
        <div class="p-5">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                <span class="text-white text-sm font-bold">âœ…</span>
              </div>
            </div>
            <div class="ml-5 w-0 flex-1">
              <dl>
                <dt class="text-sm font-medium text-gray-500 truncate">ì˜¤ëŠ˜ ì¶œê·¼</dt>
                <dd class="text-lg font-medium text-gray-900" id="today-present">-</dd>
              </dl>
            </div>
          </div>
        </div>
      </div>

      <!-- íœ´ê°€ì¤‘ -->
      <div class="bg-white overflow-hidden shadow rounded-lg">
        <div class="p-5">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center">
                <span class="text-white text-sm font-bold">ğŸ–ï¸</span>
              </div>
            </div>
            <div class="ml-5 w-0 flex-1">
              <dl>
                <dt class="text-sm font-medium text-gray-500 truncate">íœ´ê°€ì¤‘</dt>
                <dd class="text-lg font-medium text-gray-900" id="on-leave">-</dd>
              </dl>
            </div>
          </div>
        </div>
      </div>

      <!-- íœ´ê°€ ìŠ¹ì¸ ëŒ€ê¸° -->
      <div class="bg-white overflow-hidden shadow rounded-lg">
        <div class="p-5">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                <span class="text-white text-sm font-bold">â³</span>
              </div>
            </div>
            <div class="ml-5 w-0 flex-1">
              <dl>
                <dt class="text-sm font-medium text-gray-500 truncate">ìŠ¹ì¸ ëŒ€ê¸°</dt>
                <dd class="text-lg font-medium text-gray-900" id="pending-leaves">-</dd>
              </dl>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ìµœê·¼ í™œë™ -->
    <div class="bg-white shadow rounded-lg">
      <div class="px-4 py-5 sm:p-6">
        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">ìµœê·¼ í™œë™</h3>
        <div class="flow-root">
          <ul class="-mb-8" id="recent-activities">
            <li>
              <div class="flex items-center justify-center py-8">
                <div class="text-sm text-gray-500">í™œë™ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ì§ì› ê´€ë¦¬ íƒ­ -->
  <div id="employees-tab" class="mt-8 hidden">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-medium text-gray-900">ì§ì› ëª©ë¡</h3>
      <button type="button" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700" onclick="openNewEmployeeModal()">
        ìƒˆ ì§ì› ë“±ë¡
      </button>
    </div>
    
    <div class="bg-white shadow rounded-lg overflow-hidden">
      <div class="px-4 py-5 sm:p-6">
        <div id="employees-list">
          <div class="text-center py-8">
            <div class="text-sm text-gray-500">ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ê·¼íƒœ ê´€ë¦¬ íƒ­ -->
  <div id="attendance-tab" class="mt-8 hidden">
    <div class="mb-4">
      <h3 class="text-lg font-medium text-gray-900">ê·¼íƒœ í˜„í™©</h3>
      <div class="mt-2 flex space-x-4">
        <input type="date" id="attendance-date" class="border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm">
        <button type="button" onclick="loadAttendance()" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
          ì¡°íšŒ
        </button>
      </div>
    </div>
    
    <div class="bg-white shadow rounded-lg overflow-hidden">
      <div class="px-4 py-5 sm:p-6">
        <div id="attendance-list">
          <div class="text-center py-8">
            <div class="text-sm text-gray-500">ê·¼íƒœ í˜„í™©ì„ ì„ íƒí•˜ì„¸ìš”</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- íœ´ê°€ ê´€ë¦¬ íƒ­ -->
  <div id="leave-tab" class="mt-8 hidden">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-medium text-gray-900">íœ´ê°€ ì‹ ì²­ í˜„í™©</h3>
      <button type="button" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700" onclick="openNewLeaveModal()">
        íœ´ê°€ ì‹ ì²­
      </button>
    </div>
    
    <div class="bg-white shadow rounded-lg overflow-hidden">
      <div class="px-4 py-5 sm:p-6">
        <div id="leave-list">
          <div class="text-center py-8">
            <div class="text-sm text-gray-500">íœ´ê°€ ì‹ ì²­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ê¸‰ì—¬ ê´€ë¦¬ íƒ­ -->
  <div id="payroll-tab" class="mt-8 hidden">
    <div class="mb-4">
      <h3 class="text-lg font-medium text-gray-900">ê¸‰ì—¬ ê´€ë¦¬</h3>
      <div class="mt-2 flex space-x-4">
        <select id="payroll-month" class="border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm">
          <option value="">ê¸‰ì—¬ ì›” ì„ íƒ</option>
        </select>
        <button type="button" onclick="loadPayroll()" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
          ì¡°íšŒ
        </button>
      </div>
    </div>
    
    <div class="bg-white shadow rounded-lg overflow-hidden">
      <div class="px-4 py-5 sm:p-6">
        <div id="payroll-list">
          <div class="text-center py-8">
            <div class="text-sm text-gray-500">ê¸‰ì—¬ ì›”ì„ ì„ íƒí•˜ì„¸ìš”</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ìƒˆ ì§ì› ë“±ë¡ ëª¨ë‹¬ -->
<div id="new-employee-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
  <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
    <div class="mt-3">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-medium text-gray-900">ìƒˆ ì§ì› ë“±ë¡</h3>
        <button type="button" class="text-gray-400 hover:text-gray-600" onclick="closeNewEmployeeModal()">
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <form id="new-employee-form" class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div class="form-field">
            <label for="name" class="block text-sm font-medium text-gray-700">ì´ë¦„</label>
            <input type="text" id="name" name="name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            <div class="validation-icon success">âœ“</div>
            <div class="validation-icon error">âœ•</div>
            <div class="validation-icon loading">â‹¯</div>
            <div class="field-error"></div>
            <div class="field-success"></div>
          </div>
          <div class="form-field">
            <label for="department" class="block text-sm font-medium text-gray-700">ë¶€ì„œ</label>
            <select id="department" name="department" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
              <option value="">ë¶€ì„œ ì„ íƒ</option>
              <option value="ì˜ë£Œì§„">ì˜ë£Œì§„</option>
              <option value="ê°„í˜¸ë¶€">ê°„í˜¸ë¶€</option>
              <option value="í–‰ì •ë¶€">í–‰ì •ë¶€</option>
              <option value="ì‹œì„¤ê´€ë¦¬">ì‹œì„¤ê´€ë¦¬</option>
            </select>
            <div class="validation-icon success">âœ“</div>
            <div class="validation-icon error">âœ•</div>
            <div class="field-error"></div>
            <div class="field-success"></div>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="position" class="block text-sm font-medium text-gray-700">ì§ì±…</label>
            <input type="text" id="position" name="position" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          </div>
          <div>
            <label for="employment_type" class="block text-sm font-medium text-gray-700">ê³ ìš©í˜•íƒœ</label>
            <select id="employment_type" name="employment_type" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
              <option value="">ê³ ìš©í˜•íƒœ ì„ íƒ</option>
              <option value="full_time">ì •ê·œì§</option>
              <option value="contract">ê³„ì•½ì§</option>
              <option value="part_time">íŒŒíŠ¸íƒ€ì„</option>
              <option value="intern">ì¸í„´</option>
            </select>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="hire_date" class="block text-sm font-medium text-gray-700">ì…ì‚¬ì¼</label>
            <input type="date" id="hire_date" name="hire_date" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          </div>
          <div>
            <label for="salary_type" class="block text-sm font-medium text-gray-700">ê¸‰ì—¬ ìœ í˜•</label>
            <select id="salary_type" name="salary_type" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
              <option value="">ê¸‰ì—¬ ìœ í˜• ì„ íƒ</option>
              <option value="monthly">ì›”ê¸‰</option>
              <option value="hourly">ì‹œê¸‰</option>
              <option value="daily">ì¼ê¸‰</option>
            </select>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div class="form-field">
            <label for="phone" class="block text-sm font-medium text-gray-700">ì „í™”ë²ˆí˜¸</label>
            <input type="tel" id="phone" name="phone" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            <div class="validation-icon success">âœ“</div>
            <div class="validation-icon error">âœ•</div>
            <div class="validation-icon loading">â‹¯</div>
            <div class="field-error"></div>
            <div class="field-success"></div>
          </div>
          <div class="form-field">
            <label for="email" class="block text-sm font-medium text-gray-700">ì´ë©”ì¼</label>
            <input type="email" id="email" name="email" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            <div class="validation-icon success">âœ“</div>
            <div class="validation-icon error">âœ•</div>
            <div class="validation-icon loading">â‹¯</div>
            <div class="field-error"></div>
            <div class="field-success"></div>
          </div>
        </div>
        
        <div class="flex items-center justify-end pt-4 border-t space-x-3">
          <button type="button" onclick="closeNewEmployeeModal()" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
            ì·¨ì†Œ
          </button>
          <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">
            ë“±ë¡
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// í˜„ì¬ í™œì„± íƒ­
let currentTab = 'dashboard';

// íƒ­ ì „í™˜
document.querySelectorAll('[data-tab]').forEach(tab => {
  tab.addEventListener('click', function(e) {
    e.preventDefault();
    
    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
    document.querySelectorAll('[data-tab]').forEach(t => {
      t.className = 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm';
    });
    
    // ëª¨ë“  íƒ­ ë‚´ìš© ìˆ¨ê¸°ê¸°
    document.querySelectorAll('[id$="-tab"]').forEach(content => {
      content.classList.add('hidden');
    });
    
    // ì„ íƒëœ íƒ­ í™œì„±í™”
    this.className = 'border-blue-500 text-blue-600 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm';
    
    // ì„ íƒëœ íƒ­ ë‚´ìš© í‘œì‹œ
    const tabName = this.dataset.tab;
    document.getElementById(tabName + '-tab').classList.remove('hidden');
    
    currentTab = tabName;
    
    // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
    if (tabName === 'dashboard') {
      loadDashboard();
    } else if (tabName === 'employees') {
      loadEmployees();
    } else if (tabName === 'leave') {
      loadLeaveRequests();
    }
  });
});

// ëª¨ë“ˆí™”ëœ API ë° UI ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©

// ëŒ€ì‹œë³´ë“œ ë¡œë“œ
async function loadDashboard() {
  try {
    // ë¡œë”© ìƒíƒœ í‘œì‹œ
    loading.showDataLoading(
      document.getElementById('recent-activities'), 
      'ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...'
    );
    
    // ëª¨ë“ˆí™”ëœ EmployeeApi ì‚¬ìš©
    const employeesData = await employeeApi.getEmployees();
    
    const totalEmployees = employeesData.employees.length;
    const activeEmployees = employeesData.employees.filter(emp => emp.status === 'active').length;
    const onLeaveEmployees = employeesData.employees.filter(emp => emp.status === 'on_leave').length;
    
    // UIComponentsë¡œ í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
    const stats = [
      { label: 'ì´ ì§ì›', value: `${totalEmployees}ëª…`, icon: 'ğŸ‘¥', bgColor: 'bg-blue-500' },
      { label: 'ì˜¤ëŠ˜ ì¶œê·¼', value: `${activeEmployees}ëª…`, icon: 'âœ…', bgColor: 'bg-green-500' },
      { label: 'íœ´ê°€ì¤‘', value: `${onLeaveEmployees}ëª…`, icon: 'ğŸ–ï¸', bgColor: 'bg-purple-500' },
      { label: 'ìŠ¹ì¸ ëŒ€ê¸°', value: '2ê±´', icon: 'â³', bgColor: 'bg-yellow-500' }
    ];
    
    document.getElementById('total-employees').textContent = `${totalEmployees}ëª…`;
    document.getElementById('today-present').textContent = `${activeEmployees}ëª…`;
    document.getElementById('on-leave').textContent = `${onLeaveEmployees}ëª…`;
    document.getElementById('pending-leaves').textContent = '2ê±´';
    
    // ìµœê·¼ í™œë™ í‘œì‹œ (ì‹¤ì œ ë°ì´í„° ê¸°ë°˜)
    const recentActivities = [
      { type: 'íœ´ê°€ ì‹ ì²­', user: 'ì •ê°„í˜¸ì‚¬', time: '2ì‹œê°„ ì „', status: 'pending' },
      { type: 'ì‹ ê·œ ì§ì›', user: 'ë°•ì¸í„´', time: '1ì¼ ì „', status: 'completed' },
      { type: 'íœ´ê°€ ìŠ¹ì¸', user: 'í•œê°„í˜¸ì¡°ë¬´ì‚¬', time: '2ì¼ ì „', status: 'approved' }
    ];
    
    const activitiesHtml = recentActivities.map(activity => `
      <li class="py-3">
        <div class="flex items-center space-x-4">
          <div class="flex-shrink-0">
            <div class="h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center">
              <span class="text-sm font-medium text-gray-500">${activity.user[0]}</span>
            </div>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-gray-900">${activity.type}</p>
            <p class="text-sm text-gray-500">${activity.user} â€¢ ${activity.time}</p>
          </div>
          <div class="flex-shrink-0">
            ${UIComponents.createBadge(
              activity.status === 'completed' ? 'ì™„ë£Œ' : activity.status === 'approved' ? 'ìŠ¹ì¸' : 'ëŒ€ê¸°',
              activity.status === 'completed' ? 'success' : activity.status === 'approved' ? 'info' : 'warning'
            )}
          </div>
        </div>
      </li>
    `).join('');
    
    document.getElementById('recent-activities').innerHTML = activitiesHtml;
    
  } catch (error) {
    console.error('ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì‹¤íŒ¨:', error);
    toast.error('ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    
    // ì—ëŸ¬ ë°œìƒì‹œ ê¸°ë³¸ê°’ í‘œì‹œ
    document.getElementById('total-employees').textContent = '-';
    document.getElementById('today-present').textContent = '-';
    document.getElementById('on-leave').textContent = '-';
    document.getElementById('pending-leaves').textContent = '-';
    
    document.getElementById('recent-activities').innerHTML = `
      <li class="text-center py-8">
        <div class="text-sm text-red-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
      </li>
    `;
  }
}

// ì§ì› ëª©ë¡ ë¡œë“œ
async function loadEmployees() {
  try {
    // ë¡œë”© ìƒíƒœ í‘œì‹œ
    loading.showDataLoading(
      document.getElementById('employees-list'),
      'ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...'
    );
    
    // ëª¨ë“ˆí™”ëœ EmployeeApi ì‚¬ìš©
    const data = await employeeApi.getEmployees();
    
    if (data.employees && data.employees.length > 0) {
      // UIComponentsë¥¼ ì‚¬ìš©í•œ í…Œì´ë¸” ìƒì„±
      const columns = [
        { key: 'name', label: 'ì´ë¦„', render: (value, row) => {
          return `
            <div>
              <div class="flex items-center">
                <span class="font-medium text-gray-900">${value}</span>
                ${UIComponents.createBadge(row.employment_type_text, 'info')}
              </div>
              <div class="text-sm text-gray-500">${row.department} â€¢ ${row.position}</div>
              <div class="text-xs text-gray-400">ì…ì‚¬ì¼: ${row.hire_date} â€¢ ê·¼ì†: ${row.years_of_service}ë…„</div>
            </div>
          `;
        }},
        { key: 'status_text', label: 'ìƒíƒœ', render: (value, row) => {
          return UIComponents.createBadge(value, row.status === 'active' ? 'success' : 'warning');
        }},
        { key: 'actions', label: 'ì‘ì—…', render: (value, row) => {
          return `
            <div class="flex space-x-2">
              <button class="text-blue-600 hover:text-blue-800 text-sm" onclick="viewEmployee(${row.id})">ìƒì„¸ë³´ê¸°</button>
              <button class="text-red-600 hover:text-red-800 text-sm" onclick="deleteEmployee(${row.id}, '${row.name}')">ì‚­ì œ</button>
            </div>
          `;
        }}
      ];
      
      const tableHtml = UIComponents.createDataTable(data.employees, columns, {
        emptyMessage: 'ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤'
      });
      
      document.getElementById('employees-list').innerHTML = tableHtml;
    } else {
      document.getElementById('employees-list').innerHTML = UIComponents.createDataTable([], [], {
        emptyMessage: 'ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤'
      });
    }
    
  } catch (error) {
    console.error('ì§ì› ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
    toast.error('ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    document.getElementById('employees-list').innerHTML = `
      <div class="text-center py-8">
        <div class="text-sm text-red-500">ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
      </div>
    `;
  }
}

// íœ´ê°€ ì‹ ì²­ ëª©ë¡ ë¡œë“œ
async function loadLeaveRequests() {
  // ì„ì‹œ ë°ì´í„°ë¡œ íœ´ê°€ ëª©ë¡ í‘œì‹œ
  const leaves = [
    { id: 1, employee: 'ê¹€ê°„í˜¸ì‚¬', type: 'ì—°ì°¨', start_date: '2025-01-15', end_date: '2025-01-16', days: 2, status: 'ìŠ¹ì¸ëŒ€ê¸°' },
    { id: 2, employee: 'ì´ì˜ì‚¬', type: 'ë³‘ê°€', start_date: '2025-01-10', end_date: '2025-01-10', days: 1, status: 'ìŠ¹ì¸' },
    { id: 3, employee: 'ë°•í–‰ì •', type: 'ê°œì¸ì‚¬ìœ ', start_date: '2025-01-20', end_date: '2025-01-21', days: 2, status: 'ë°˜ë ¤' }
  ];
  
  const leavesHtml = leaves.map(leave => `
    <div class="border-b border-gray-200 py-4">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <div class="flex items-center">
            <h4 class="text-sm font-medium text-gray-900">${leave.employee}</h4>
            <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-purple-800 bg-purple-100">
              ${leave.type}
            </span>
          </div>
          <div class="mt-1 text-sm text-gray-500">
            ${leave.start_date} ~ ${leave.end_date} (${leave.days}ì¼)
          </div>
        </div>
        <div class="flex items-center space-x-2">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${leave.status === 'ìŠ¹ì¸' ? 'text-green-800 bg-green-100' : leave.status === 'ë°˜ë ¤' ? 'text-red-800 bg-red-100' : 'text-yellow-800 bg-yellow-100'}">
            ${leave.status}
          </span>
          ${leave.status === 'ìŠ¹ì¸ëŒ€ê¸°' ? '<button class="text-blue-600 hover:text-blue-800 text-sm">ìŠ¹ì¸ì²˜ë¦¬</button>' : ''}
        </div>
      </div>
    </div>
  `).join('');
  
  document.getElementById('leave-list').innerHTML = leavesHtml;
}

// ëª¨ë‹¬ ê´€ë¦¬ - UIComponents ì‚¬ìš©
function openNewEmployeeModal() {
  UIComponents.openModal('new-employee-modal');
}

function closeNewEmployeeModal() {
  UIComponents.closeModal('new-employee-modal');
  UIComponents.resetForm('new-employee-form');
}

function openNewLeaveModal() {
  // íœ´ê°€ ì‹ ì²­ ëª¨ë‹¬ êµ¬í˜„ (ê°„ë‹¨í•œ ì•Œë¦¼ìœ¼ë¡œ ëŒ€ì²´)
  toast.info('íœ´ê°€ ì‹ ì²­ ê¸°ëŠ¥ì´ êµ¬í˜„ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
}

// ê·¼íƒœ ì¡°íšŒ
function loadAttendance() {
  const date = document.getElementById('attendance-date').value;
  if (!date) {
    toast.warning('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”');
    return;
  }
  
  // ì„ì‹œ ë°ì´í„°ë¡œ ê·¼íƒœ í˜„í™© í‘œì‹œ
  const attendanceHtml = `
    <div class="text-center py-8">
      <div class="text-sm text-gray-500">${date} ê·¼íƒœ í˜„í™©</div>
      <div class="mt-4 text-lg font-medium text-gray-900">ì¶œê·¼: 42ëª… / ì´ 45ëª…</div>
    </div>
  `;
  
  document.getElementById('attendance-list').innerHTML = attendanceHtml;
}

// ê¸‰ì—¬ ì¡°íšŒ
function loadPayroll() {
  const month = document.getElementById('payroll-month').value;
  if (!month) {
    toast.warning('ê¸‰ì—¬ ì›”ì„ ì„ íƒí•˜ì„¸ìš”');
    return;
  }
  
  // ì„ì‹œ ë°ì´í„°ë¡œ ê¸‰ì—¬ í˜„í™© í‘œì‹œ
  const payrollHtml = `
    <div class="text-center py-8">
      <div class="text-sm text-gray-500">${month} ê¸‰ì—¬ í˜„í™©</div>
      <div class="mt-4 text-lg font-medium text-gray-900">ì´ ê¸‰ì—¬: 125,000,000ì›</div>
    </div>
  `;
  
  document.getElementById('payroll-list').innerHTML = payrollHtml;
}

// ê¸‰ì—¬ ì›” ì˜µì…˜ ìƒì„±
function initializePayrollMonths() {
  const select = document.getElementById('payroll-month');
  const currentDate = new Date();
  
  for (let i = 0; i < 12; i++) {
    const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
    const value = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
    const text = `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›”`;
    
    const option = document.createElement('option');
    option.value = value;
    option.textContent = text;
    select.appendChild(option);
  }
}

// ìƒˆ ì§ì› ë“±ë¡
document.getElementById('new-employee-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const form = e.target;
  const submitButton = form.querySelector('button[type="submit"]');
  
  // í¼ ê²€ì¦
  if (!validator.validateForm(form)) {
    toast.warning('ì…ë ¥ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”');
    return;
  }
  
  loading.setButtonLoading(submitButton, true);
  
  try {
    // UIComponentsë¡œ í¼ ë°ì´í„° ë³€í™˜
    const employeeData = UIComponents.formDataToObject(form);
    
    // ëª¨ë“ˆí™”ëœ EmployeeApi ì‚¬ìš©
    const result = await employeeApi.createEmployee(employeeData);
    
    toast.success(result.message || 'ì§ì›ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
    closeNewEmployeeModal();
    
    if (currentTab === 'employees') {
      loadEmployees();
    }
    if (currentTab === 'dashboard') {
      loadDashboard();
    }
    
  } catch (error) {
    console.error('ì§ì› ë“±ë¡ ì‹¤íŒ¨:', error);
    
    if (error.details) {
      const errorMsg = Array.isArray(error.details) ? error.details.join(', ') : error.details;
      toast.error(`ë“±ë¡ ì‹¤íŒ¨: ${errorMsg}`);
    } else {
      toast.error(error.message || 'ì§ì› ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  } finally {
    loading.setButtonLoading(submitButton, false);
  }
});

// ì§ì› ìƒì„¸ë³´ê¸°
async function viewEmployee(employeeId) {
  try {
    // ëª¨ë“ˆí™”ëœ EmployeeApi ì‚¬ìš©
    const data = await employeeApi.getEmployee(employeeId);
    const emp = data.employee;
    
    // UIComponentsë¡œ ëª¨ë‹¬ ìƒì„±
    const employeeDetails = `
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">ì´ë¦„</label>
            <div class="mt-1 text-sm text-gray-900">${emp.name}</div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">ë¶€ì„œ</label>
            <div class="mt-1 text-sm text-gray-900">${emp.department}</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">ì§ì±…</label>
            <div class="mt-1 text-sm text-gray-900">${emp.position}</div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">ê³ ìš©í˜•íƒœ</label>
            <div class="mt-1">${UIComponents.createBadge(emp.employment_type_text, 'info')}</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">ì…ì‚¬ì¼</label>
            <div class="mt-1 text-sm text-gray-900">${emp.hire_date}</div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">ê·¼ì†ë…„ìˆ˜</label>
            <div class="mt-1 text-sm text-gray-900">${emp.years_of_service}ë…„</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">ì „í™”ë²ˆí˜¸</label>
            <div class="mt-1 text-sm text-gray-900">${emp.phone || 'ë¯¸ì…ë ¥'}</div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">ì´ë©”ì¼</label>
            <div class="mt-1 text-sm text-gray-900">${emp.email}</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">ê¸‰ì—¬í˜•íƒœ</label>
            <div class="mt-1 text-sm text-gray-900">${emp.salary_type_text}</div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">ì—°ì°¨ ì”ì—¬</label>
            <div class="mt-1 text-sm text-gray-900">${emp.annual_leave_balance}ì¼</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">ê¸°ë³¸ê¸‰/ì‹œê¸‰</label>
            <div class="mt-1 text-sm text-gray-900">
              ${emp.base_salary ? emp.base_salary.toLocaleString() + 'ì›' : ''}
              ${emp.hourly_rate ? emp.hourly_rate.toLocaleString() + 'ì›/ì‹œ' : ''}
              ${!emp.base_salary && !emp.hourly_rate ? 'ë¯¸ì…ë ¥' : ''}
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">ìƒíƒœ</label>
            <div class="mt-1">${UIComponents.createBadge(emp.status_text, emp.status === 'active' ? 'success' : 'warning')}</div>
          </div>
        </div>
      </div>
    `;
    
    const modalHtml = UIComponents.createModal(
      'employee-detail-modal',
      'ì§ì› ì •ë³´',
      employeeDetails,
      [{
        label: 'ë‹«ê¸°',
        onclick: "UIComponents.closeModal('employee-detail-modal')",
        className: 'px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50'
      }]
    );
    
    // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
    const existingModal = document.getElementById('employee-detail-modal');
    if (existingModal) {
      existingModal.remove();
    }
    
    // ìƒˆ ëª¨ë‹¬ ì¶”ê°€
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    UIComponents.openModal('employee-detail-modal');
    
  } catch (error) {
    console.error('ì§ì› ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
    toast.error(error.message || 'ì§ì› ì •ë³´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  }
}

// ì§ì› ì‚­ì œ
async function deleteEmployee(employeeId, employeeName) {
  // UIComponentsì˜ confirm ì‚¬ìš©
  const confirmed = UIComponents.confirm(`ì •ë§ë¡œ '${employeeName}' ì§ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
  
  if (!confirmed) {
    return;
  }
  
  try {
    // ëª¨ë“ˆí™”ëœ EmployeeApi ì‚¬ìš©
    const result = await employeeApi.deleteEmployee(employeeId);
    
    toast.success(result.message || 'ì§ì›ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    
    if (currentTab === 'employees') {
      loadEmployees();
    }
    if (currentTab === 'dashboard') {
      loadDashboard();
    }
    
  } catch (error) {
    console.error('ì§ì› ì‚­ì œ ì‹¤íŒ¨:', error);
    toast.error(error.message || 'ì§ì› ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', () => {
  initializePayrollMonths();
  loadDashboard();
  
  // í¼ ê²€ì¦ ì„¤ì •
  setupFormValidation();
});

// í¼ ê²€ì¦ ì„¤ì •
function setupFormValidation() {
  // ì´ë¦„ í•„ë“œ ê²€ì¦ ê·œì¹™
  validator.addRule('name', FormValidator.rules.required('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'));
  validator.addRule('name', FormValidator.rules.minLength(2));
  validator.addRule('name', FormValidator.rules.maxLength(50));
  validator.addRule('name', FormValidator.rules.korean());

  // ë¶€ì„œ í•„ë“œ ê²€ì¦ ê·œì¹™
  validator.addRule('department', FormValidator.rules.required('ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'));

  // ì§ì±… í•„ë“œ ê²€ì¦ ê·œì¹™  
  validator.addRule('position', FormValidator.rules.required('ì§ì±…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'));
  validator.addRule('position', FormValidator.rules.minLength(2));
  validator.addRule('position', FormValidator.rules.maxLength(30));

  // ê³ ìš©í˜•íƒœ í•„ë“œ ê²€ì¦ ê·œì¹™
  validator.addRule('employment_type', FormValidator.rules.required('ê³ ìš©í˜•íƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'));

  // ì…ì‚¬ì¼ í•„ë“œ ê²€ì¦ ê·œì¹™
  validator.addRule('hire_date', FormValidator.rules.required('ì…ì‚¬ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'));

  // ê¸‰ì—¬í˜•íƒœ í•„ë“œ ê²€ì¦ ê·œì¹™
  validator.addRule('salary_type', FormValidator.rules.required('ê¸‰ì—¬í˜•íƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'));

  // ì „í™”ë²ˆí˜¸ í•„ë“œ ê²€ì¦ ê·œì¹™ (ì„ íƒì )
  validator.addRule('phone', FormValidator.rules.phone());

  // ì´ë©”ì¼ í•„ë“œ ê²€ì¦ ê·œì¹™
  validator.addRule('email', FormValidator.rules.required('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'));
  validator.addRule('email', FormValidator.rules.email());

  // í¼ í•„ë“œë“¤ì— ì‹¤ì‹œê°„ ê²€ì¦ ë°”ì¸ë”©
  const form = document.getElementById('new-employee-form');
  const fields = form.querySelectorAll('[name]');
  
  fields.forEach(field => {
    validator.bindField(field);
  });
}
</script>
